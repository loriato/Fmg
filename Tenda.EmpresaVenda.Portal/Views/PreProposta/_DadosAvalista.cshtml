@using Europa.Resources
@using Europa.Extensions
@model Tenda.EmpresaVenda.Portal.Models.PrePropostaDTO

<link href="~/Static/projeto/pre-proposta/proposta.css" rel="stylesheet" />

@{ 
    var atualizar = (Model.KitCompleto && !Model.AvalistaDTO.DocsPendentes) && !Model.AvalistaDTO.DocsAprovados || Model.PossuiPosChaves && !Model.AvalistaDTO.DocsAprovados;
}

<script>
    Europa.Controllers.PreProposta.DadosAvalista.UrlListarDocumentos = '@Url.Action("DocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlIncluirAvalista = '@Url.Action("IncluirAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlAlterarAvalista = '@Url.Action("AlterarAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlUploadDocumentoAvalista = '@Url.Action("UploadDocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlExcluirDocumentoAvalista = '@Url.Action("ExcluirDocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlBaixarTodosDocumentosAvalista = '@Url.Action("BaixarTodosDocumentosAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.UrlEnviarDocumentosAvalista = '@Url.Action("EnviarDocumentosAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.DadosAvalista.Permissoes = {
        Atualizar: '@atualizar' == 'True',
        Excluir: true
    };
</script>

@Html.HiddenFor(x=>x.StatusConformidade)

<form id="form_avalista">
    <div class="col-md-24">
        @Html.HiddenFor(x => x.AvalistaDTO.Avalista.Id)
        <div class="col-md-5 form-group">
            @Html.Label(GlobalMessages.Nome + "*", new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Nome, new { @class = "form-control avalista", disabled = "disabled" })
        </div>

        <div class="col-md-6 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.Email, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Email, new { @class = "form-control avalista", disabled = "disabled" })
        </div>

        <div class="col-md-5 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.RG, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.RG, new { @class = "form-control avalista", maxlength = "14", disabled = "disabled" })
        </div>

        <div class="col-md-5 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.OrgaoEmissor, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.OrgaoExpedicao, new { @class = "form-control avalista", disabled = "disabled" })
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-5 form-group">
            @Html.Label(GlobalMessages.Cpf + "*", new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.CPF, new { @class = "form-control avalista", maxlength = "14", disabled="disabled" })
        </div>

        <div class="col-md-6 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.Profissao , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Profissao, new { @class = "form-control avalista", disabled="disabled" })
        </div>

        <div class="col-md-5 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.Empresa , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Empresa, new { @class = "form-control avalista", disabled="disabled" })
        </div>

        <div class="col-md-5 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.TempoEmpresa, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.TempoEmpresa, new { @class = "form-control avalista text-right inteiro", disabled="disabled" })
        </div>
    </div>

    <div class="col-md-24">
        @Html.HiddenFor(x => x.AvalistaDTO.Endereco.Id)

        <div class="col-md-9 form-group">
            @Html.Label(GlobalMessages.Endereco, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Logradouro, new { @class = "form-control avalista", maxlength = 60, disabled="disabled" })
        </div>

        <div class="col-md-2 form-group col-md-offset-1 ">
            @Html.Label(GlobalMessages.Numero  , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Numero, new { @class = "form-control avalista", maxlength = 40, disabled="disabled" })
        </div>

        <div class="col-md-11 form-group col-md-offset-1 ">
            @Html.Label(GlobalMessages.Bairro, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Bairro, new { @class = "form-control avalista", maxlength = 40, disabled="disabled" })
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-6 form-group">
            @Html.Label(GlobalMessages.CEP , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Cep, new { @class = "form-control cep avalista", maxlength = 9, onchange = "Europa.Controllers.PreProposta.DadosAvalista.OnChangeCepEnderecoAvalista(this)", disabled="disabled" })
        </div>

        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Cidade  ,new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Cidade, new { @class = "form-control avalista", maxlength = 40, disabled="disabled" })
        </div>

        <div class="col-md-2 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.UF , new { @class = "control-label" })
            @{
                if (Model.HasValue() && Model.AvalistaDTO.Endereco.HasValue() && Model.AvalistaDTO.Endereco.Estado.HasValue())
                {
                    Html.RenderPartial("_EstadosDropDownList", Tuple.Create("EnderecoAvalista.Estado", Model.AvalistaDTO.Endereco.Estado));
                }
                else
                {
                    Html.RenderPartial("_EstadosDropDownList", Tuple.Create("EnderecoAvalista.Estado", "Estado"));
                }
            }
        </div>

        <div class="col-md-3 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.RendaDeclarada , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.RendaDeclarada, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled="disabled", Value = Model.AvalistaDTO.Avalista?.RendaDeclarada.ToString("F") })
        </div>
        <div class="col-md-4 col-md-offset-1">
            @Html.Label(GlobalMessages.OutrasRendas , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.OutrasRendas, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled="disabled", Value = Model.AvalistaDTO.Avalista?.OutrasRendas.ToString("F") })
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-3 form-group">
            @Html.Label(GlobalMessages.Banco , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Banco, new { @class = "form-control avalista", maxlength = 40, disabled="disabled" })
        </div>

        <div class="col-md-4 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.ContatoGerente , new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.ContatoGerente, new { @class = "form-control avalista", maxlength = 40, disabled="disabled" })
        </div>

        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.ValorTotalBens, new { @class = "control-label" })
            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.ValorTotalBens, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled="disabled", Value = Model.AvalistaDTO.Avalista?.ValorTotalBens.ToString("F") })
        </div>

        <div class="col-md-4 form-group col-md-offset-1">
            @Html.Label(GlobalMessages.PossuiImovel, new { @class = "control-label" })
            <div class="col-md-24">
                <div class="col-md-12">
                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiImovel, true, new { id = "Avalista_PossuiImovel_Sim" ,@class="avalista"}) <label class="control-label" for="Avalista_PossuiImovel_Sim">@GlobalMessages.Sim</label>
                </div>
                <div class="col-md-12">
                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiImovel, false, new { id = "Avalista_PossuiImovel_Nao" ,@class="avalista"}) <label class="control-label" for="Avalista_PossuiImovel_Nao">@GlobalMessages.Nao</label>
                </div>
            </div>
        </div>

        <div class="col-md-4 form-group">
            @Html.Label(GlobalMessages.PossuiVeiculo, new { @class = "control-label" })
            <div class="col-md-24">
                <div class="col-md-12">
                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiVeiculo, true, new { id = "Avalista_PossuiVeiculo_Sim",@class="avalista" }) <label class="control-label" for="Avalista_PossuiVeiculo_Sim">@GlobalMessages.Sim</label>
                </div>
                <div class="col-md-12">
                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiVeiculo, false, new { id = "Avalista_PossuiVeiculo_Nao",@class="avalista" }) <label class="control-label" for="Avalista_PossuiVeiculo_Nao">@GlobalMessages.Nao</label>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="col-md-24 teste-aparecer" style="text-align: center;margin-top: 7px;"><hr class="hr-mais-filtro" /></div>

<form id="form_cliente">
    <div class=" col-md-24">
        <div class="col-md-18 form-group">
            <h5>@GlobalMessages.DadosCliente</h5>
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-4 form-group">
            @Html.Label(GlobalMessages.Codigo, new { @class = "control-label" })
            @Html.TextBox("codigo_ppr",Model.PreProposta.Codigo, new { @class = "form-control", @maxlength = 30, @readonly = "readonly" })
        </div>
        <div class="col-md-7 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Cliente + " *", new { @class = "control-label" })
            <div class="input-group">
                @Html.TextBox("nome_cliente_1",Model.PreProposta.Cliente?.NomeCompleto, new { @class = "form-control disabled"})
                <span class="input-group-btn">
                    <button  type="button" class="btn control-label disabled">
                        <i class="fa fa-search"></i>
                    </button>
                </span>
            </div>
        </div>

        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.DataElaboracao, new { @class = "control-label" })
            @Html.TextBox("data_elaboracao",Model.PreProposta.DataElaboracao, "{0:dd/MM/yyyy HH:mm}", new { @class = "form-control", @readonly = "readonly" })
        </div>
        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Status, new { @class = "control-label" })
            @Html.TextBox("nome_situacao_evs",Model.SituacaoPrepropostaSuatEvs, new { @class = "form-control", @readonly = "readonly" })
        </div>
    </div>
    <div class="col-md-24">
        <div class="col-md-4 form-group">
            @Html.Label(GlobalMessages.EmpresaVenda, new { @class = "control-label" })
            @Html.TextBox("nome_empresa_venda",Model.PreProposta.EmpresaVenda.NomeFantasia, new { @class = "form-control", @maxlength = 30, @readonly = "readonly" })
        </div>
        <div class="col-md-7 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.PontoVenda + " *", new { @class = "control-label" })
            @Html.TextBoxFor(x=>x.PreProposta.PontoVenda.Nome, new { @class = "form-control",id="nome_ponto_venda"})
        </div>
        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Corretor, new { @class = "control-label" })
            @Html.TextBox("nome_corretor",Model.PreProposta.Corretor.Nome, new { @class = "form-control", @readonly = "readonly" })
        </div>
        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Gerente, new { @class = "control-label" })
            @Html.TextBox("nome_gerente",Model.PreProposta.Elaborador.Nome, new { @class = "form-control", @readonly = "readonly" })
        </div>
    </div>
    <div class="col-md-24">
        <div class="col-md-12 form-group">
            @Html.Label(GlobalMessages.EmpresasVendas_Produto + " *", new { @class = "control-label" })
            @Html.TextBoxFor(x=>x.PreProposta.BreveLancamento.Nome,new { @class="form-control", disabled="disabled",id="nome_breve_1"})
        </div>
        <div class="col-md-11 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Viabilizador, new { @class = "control-label" })
            @Html.TextBoxFor(x=>x.PreProposta.Viabilizador.Nome, new { @class = "form-control", @readonly = "readonly",id="nome_viabilizador" })
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-6 form-group">
            @Html.Label(GlobalMessages.Torre + " *")
            @Html.TextBox("nome_torre",Model.PreProposta.NomeTorre, new { @class = "form-control", @readonly = "readonly" })
        </div>
        <div class="col-md-5 col-md-offset-1 form-group">
            @Html.Label(GlobalMessages.Unidade, new { @class = "control-label" })
            @Html.TextBox("nome_unidade",Model.PreProposta.IdentificadorUnidadeSuat, new { @class = "form-control", maxlength = 128 })
        </div>

        <div id="area_totais">
            <div class="col-md-3 col-md-offset-1">
                @Html.Label(GlobalMessages.TotalDetalhamentoFinanceiro, new { @class = "control-label" })
                @Html.TextBox("total_detalhamento",Model.PreProposta.TotalDetalhamentoFinanceiro, new { @class = "form-control text-right dinheiro", maxlength = 13, @readonly = "readonly", Value = Model.PreProposta.TotalDetalhamentoFinanceiro.ToString("F") })
            </div>
            <div class="col-md-3 col-md-offset-1">
                @Html.Label(GlobalMessages.TotalItbiEmolumento, new { @class = "control-label" })
                @Html.TextBox("total_itbi",Model.PreProposta.TotalItbiEmolumento, new { @class = "form-control text-right dinheiro", @maxlength = 13, Value = Model.PreProposta.TotalItbiEmolumento.ToString("F"), @readonly = "readonly" })
            </div>
            <div class="col-md-3 col-md-offset-1">
                @Html.Label(GlobalMessages.Total, new { @class = "control-label" })
                @Html.TextBox("total",Model.PreProposta.Valor, new { @class = "form-control text-right dinheiro", @maxlength = 13, Value = Model.PreProposta.Valor.ToString("F"), @readonly = "readonly" })
            </div>
            <script>
                Europa.String.FormatAsMoney($('#PreProposta_TotalDetalhamentoFinanceiro').val());
                Europa.String.FormatAsMoney($('#PreProposta_TotalItbiEmolumento').val());
                Europa.String.FormatAsMoney($('#PreProposta_Valor').val());
                Europa.String.FormatAsMoney($('#PreProposta_ParcelaAprovada').val())
            </script>
        </div>
    </div>

    <div class="col-md-24">
        <div class="col-md-12">
            @Html.Label(GlobalMessages.Endereco, new { @class = "control-label" })
            @Html.TextBox("endereco_breve_1",Model.EnderecoBreveLancamento, new { @class = "form-control", @maxlength = 128, @readonly = "readonly" })
        </div>
    </div>
</form>

<div class="col-md-24 teste-aparecer" style="text-align: center;margin-top: 7px;"><hr class="hr-mais-filtro" /></div>

<form id="form_unidade">
    <div class=" col-md-24">
        <div class="col-md-18 form-group">
            <h5>@GlobalMessages.DadosUnidade</h5>
        </div>
    </div>
    <div class="col-md-24">
        <div class="col-md-7 form-group">
            @Html.Label(GlobalMessages.EmpresasVendas_Produto + " *", new { @class = "control-label" })
            @Html.TextBoxFor(x=>x.PreProposta.BreveLancamento.Nome, new { @class = "form-control", disabled = "disabled",id="nome_breve_2" })
        </div>
        <div class="col-md-10 col-md-offset-1">
            @Html.Label(GlobalMessages.Endereco, new { @class = "control-label" })
            @Html.TextBoxFor(x=>x.EnderecoBreveLancamento, new { @class = "form-control", @maxlength = 128, @readonly = "readonly",id="endereco_breve_2"})
        </div>
    </div>
    <div class="col-md-24">
        @Html.Label("*" + GlobalMessages.CamposObrigatorios, new { @class = "campos-obrigatrio" })
    </div>
</form>

<form id="documentos_obrigatorios">
    <div class="col-md-24">
        <div ng-controller="documentoAvalistaTable as table">
            <div id="documento_avalista_datatable_header">
                <div class="col-md-20">
                    <div class="col-md-12 form-group">
                        <h5>@GlobalMessages.DocumentosObrigatorios</h5>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="col-md-3 pull-left">
                        <button id="btn_baixar_documentos_avalista" class="btn" type="button"
                                onclick="Europa.Controllers.PreProposta.DadosAvalista.BaixarTodosDocumentosAvalista()">
                            <i class="fa fa-download"></i> @GlobalMessages.BaixarTodosDocumentos
                        </button>
                    </div>
                </div>
            </div>
            <table datatable="" dt-options="table.dtOptions" dt-columns="table.dtColumns"
                   dt-instance="table.dtInstance" class="table"
                   dt-column-defs="table.dtColumnDefs"></table>
        </div>
    </div>
</form>

<div class="col-md-24">
    <div class="modal" id="documento_avalista_modal_upload" tabindex="-1" role="dialog" data-backdrop="static">
        <div class="modal-dialog" role="document" style="width: 500px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">@GlobalMessages.UploadDocumentoAvalista</h4>
                </div>
                <div class="modal-body">
                    <div id="form_upload_documento_avalista">
                        <div class="col-md-24">
                            @Html.Label(GlobalMessages.Motivo)
                            @Html.TextBox("ArquivoDescricaoMotivoAvalista", null, new { @class = "form-control", @maxlength = "255" })
                        </div>
                        <div class="col-md-24">
                            @Html.Label(GlobalMessages.EnvioDeArquivo + " *", new { @class = "control-label", style = "overflow: hidden;" })
                            <input name="arquivoAvalista" id="arquivoAvalista" type="file" class="control-label" style="width: 100%;" accept="application/pdf">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" title="@GlobalMessages.Enviar" onclick="Europa.Controllers.PreProposta.DadosAvalista.Upload()">
                        <i class="fa fa-upload" aria-hidden="true"></i> @GlobalMessages.Enviar
                    </button>
                    <button type="button" class="btn" title="@GlobalMessages.Fechar" onclick="Europa.Controllers.PreProposta.DadosAvalista.Modal.Hide()">
                        <i class="fa fa-close"></i> @GlobalMessages.Fechar
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    Europa.String.FormatAsMoney($('#AvalistaDTO_Avalista_RendaDeclarada').val());
</script>