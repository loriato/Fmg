@using Europa.Resources
@using Europa.Extensions
@model Tenda.EmpresaVenda.Web.Models.PrePropostaDTO

<script src="~/Static/projeto/pre-proposta/modal-avalista.js"></script>

@{
    var atualizar = (Model.KitCompleto && !Model.AvalistaDTO.DocsPendentes) && !Model.AvalistaDTO.DocsAprovados || Model.PossuiPosChaves && !Model.AvalistaDTO.DocsAprovados;
}

<script>
    Europa.Controllers.PreProposta.ModalAvalista.UrlListarDocumentos = '@Url.Action("DocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlIncluirAvalista = '@Url.Action("IncluirAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlAlterarAvalista = '@Url.Action("AlterarAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlUploadDocumentoAvalista = '@Url.Action("UploadDocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlExcluirDocumentoAvalista = '@Url.Action("ExcluirDocumentoAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlBaixarTodosDocumentosAvalista = '@Url.Action("BaixarTodosDocumentosAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.UrlEnviarDocumentosAvalista = '@Url.Action("EnviarDocumentosAvalista", "PreProposta")';
    Europa.Controllers.PreProposta.ModalAvalista.Permissoes = {
        Atualizar: '@atualizar' == 'True',
        Excluir: true
    };
</script>

<div id="modal-avalista-preproposta" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 80%;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">@GlobalMessages.Avalista</h4>
            </div>
            <div class="modal-body">
                <form id="form_avalista">
                    <div class="col-md-24">
                        @Html.HiddenFor(x => x.AvalistaDTO.Avalista.Id)
                        <div class="col-md-5 form-group">
                            @Html.Label(GlobalMessages.Nome + "*", new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Nome, new { @class = "form-control avalista", disabled = "disabled" })
                        </div>

                        <div class="col-md-6 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.Email, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Email, new { @class = "form-control avalista", disabled = "disabled" })
                        </div>

                        <div class="col-md-5 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.RG, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.RG, new { @class = "form-control avalista", maxlength = "14", disabled = "disabled" })
                        </div>

                        <div class="col-md-5 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.OrgaoEmissor, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.OrgaoExpedicao, new { @class = "form-control avalista", disabled = "disabled" })
                        </div>
                    </div>

                    <div class="col-md-24">
                        <div class="col-md-5 form-group">
                            @Html.Label(GlobalMessages.Cpf + "*", new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.CPF, new { @class = "form-control avalista", maxlength = "14", disabled = "disabled" })
                        </div>

                        <div class="col-md-6 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.Profissao, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Profissao, new { @class = "form-control avalista", disabled = "disabled" })
                        </div>

                        <div class="col-md-5 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.Empresa, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Empresa, new { @class = "form-control avalista", disabled = "disabled" })
                        </div>

                        <div class="col-md-5 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.TempoEmpresa, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.TempoEmpresa, new { @class = "form-control avalista text-right inteiro", disabled = "disabled" })
                        </div>
                    </div>

                    <div class="col-md-24">
                        @Html.HiddenFor(x => x.AvalistaDTO.Endereco.Id)

                        <div class="col-md-9 form-group">
                            @Html.Label(GlobalMessages.Endereco, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Logradouro, new { @class = "form-control avalista", maxlength = 60, disabled = "disabled" })
                        </div>

                        <div class="col-md-2 form-group col-md-offset-1 ">
                            @Html.Label(GlobalMessages.Numero, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Numero, new { @class = "form-control avalista", maxlength = 40, disabled = "disabled" })
                        </div>

                        <div class="col-md-11 form-group col-md-offset-1 ">
                            @Html.Label(GlobalMessages.Bairro, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Bairro, new { @class = "form-control avalista", maxlength = 40, disabled = "disabled" })
                        </div>
                    </div>

                    <div class="col-md-24">
                        <div class="col-md-6 form-group">
                            @Html.Label(GlobalMessages.CEP, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Cep, new { @class = "form-control cep avalista", maxlength = 9, onchange = "Europa.Controllers.PreProposta.ModalAvalista.OnChangeCepEnderecoAvalista(this)", disabled = "disabled" })
                        </div>

                        <div class="col-md-5 col-md-offset-1 form-group">
                            @Html.Label(GlobalMessages.Cidade, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Endereco.Cidade, new { @class = "form-control avalista", maxlength = 40, disabled = "disabled" })
                        </div>

                        <div class="col-md-2 col-md-offset-1 form-group">
                            @Html.Label(GlobalMessages.UF, new { @class = "control-label" })
                            @{
                                if (Model.HasValue() && Model.AvalistaDTO.Endereco.HasValue() && Model.AvalistaDTO.Endereco.Estado.HasValue())
                                {
                                    Html.RenderPartial("_EstadosDropDownList", Tuple.Create("EnderecoAvalista.Estado", Model.AvalistaDTO.Endereco.Estado));
                                }
                                else
                                {
                                    Html.RenderPartial("_EstadosDropDownList", Tuple.Create("EnderecoAvalista.Estado", "Estado"));
                                }
                            }
                        </div>

                        <div class="col-md-3 col-md-offset-1 form-group">
                            @Html.Label(GlobalMessages.RendaDeclarada, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.RendaDeclarada, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled = "disabled", Value = Model.AvalistaDTO.Avalista?.RendaDeclarada.ToString("F") })
                        </div>
                        <div class="col-md-4 col-md-offset-1">
                            @Html.Label(GlobalMessages.OutrasRendas, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.OutrasRendas, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled = "disabled", Value = Model.AvalistaDTO.Avalista?.OutrasRendas.ToString("F") })
                        </div>
                    </div>

                    <div class="col-md-24">
                        <div class="col-md-3 form-group">
                            @Html.Label(GlobalMessages.Banco, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.Banco, new { @class = "form-control avalista", maxlength = 40, disabled = "disabled" })
                        </div>

                        <div class="col-md-4 col-md-offset-1 form-group">
                            @Html.Label(GlobalMessages.ContatoGerente, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.ContatoGerente, new { @class = "form-control avalista", maxlength = 40, disabled = "disabled" })
                        </div>

                        <div class="col-md-5 col-md-offset-1 form-group">
                            @Html.Label(GlobalMessages.ValorTotalBens, new { @class = "control-label" })
                            @Html.TextBoxFor(x => x.AvalistaDTO.Avalista.ValorTotalBens, new { @class = "form-control text-right avalista dinheiro", maxlength = 13, disabled = "disabled", Value = Model.AvalistaDTO.Avalista?.ValorTotalBens.ToString("F") })
                        </div>

                        <div class="col-md-4 form-group col-md-offset-1">
                            @Html.Label(GlobalMessages.PossuiImovel, new { @class = "control-label" })
                            <div class="col-md-24">
                                <div class="col-md-12">
                                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiImovel, true, new { id = "Avalista_PossuiImovel_Sim", @class = "avalista" }) <label class="control-label" for="Avalista_PossuiImovel_Sim">@GlobalMessages.Sim</label>
                                </div>
                                <div class="col-md-12">
                                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiImovel, false, new { id = "Avalista_PossuiImovel_Nao", @class = "avalista" }) <label class="control-label" for="Avalista_PossuiImovel_Nao">@GlobalMessages.Nao</label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 form-group">
                            @Html.Label(GlobalMessages.PossuiVeiculo, new { @class = "control-label" })
                            <div class="col-md-24">
                                <div class="col-md-12">
                                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiVeiculo, true, new { id = "Avalista_PossuiVeiculo_Sim", @class = "avalista" }) <label class="control-label" for="Avalista_PossuiVeiculo_Sim">@GlobalMessages.Sim</label>
                                </div>
                                <div class="col-md-12">
                                    @Html.RadioButtonFor(reg => reg.AvalistaDTO.Avalista.PossuiVeiculo, false, new { id = "Avalista_PossuiVeiculo_Nao", @class = "avalista" }) <label class="control-label" for="Avalista_PossuiVeiculo_Nao">@GlobalMessages.Nao</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form id="documentos_obrigatorios">
                        <div class="col-md-24">
                            <div ng-controller="documentoAvalistaTable as table">
                                <div id="documento_avalista_datatable_header">
                                    <div class="col-md-20">
                                        <div class="col-md-12 form-group">
                                            <h5>@GlobalMessages.DocumentosObrigatorios</h5>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="col-md-3 pull-left">
                                            <button id="btn_baixar_documentos_avalista" class="btn btn-default" type="button"
                                                    onclick="Europa.Controllers.PreProposta.ModalAvalista.BaixarTodosDocumentosAvalista()">
                                                <i class="fa fa-download"></i> @GlobalMessages.BaixarTodosDocumentos
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <table datatable="" dt-options="table.dtOptions" dt-columns="table.dtColumns"
                                       dt-instance="table.dtInstance" class="table"
                                       dt-column-defs="table.dtColumnDefs"></table>
                            </div>
                        </div>
                    </form>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i> @GlobalMessages.Fechar</button>
                <button id="btn_enviar_documentos_avalista" class="btn btn-default hidden" type="button" onclick="Europa.Controllers.PreProposta.ModalAvalista.EnviarDocumentosAvalista()">
                    <i class="fa fa-send"></i> @GlobalMessages.EnviarDocsAvalista
                </button>
                <button id="btn_salvar_avalista" class="btn btn-default hidden" type="button" onclick="Europa.Controllers.PreProposta.ModalAvalista.CadastrarAvalista()">
                    <i class="fa fa-save"></i> @GlobalMessages.Salvar
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div class="col-md-24">
    <div class="modal" id="documento_avalista_modal_upload" tabindex="-1" role="dialog" data-backdrop="static">
        <div class="modal-dialog" role="document" style="width: 500px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">@GlobalMessages.UploadDocumentoAvalista</h4>
                </div>
                <div class="modal-body">
                    <div id="form_upload_documento_avalista">
                        <div class="col-md-24">
                            @Html.Label(GlobalMessages.Motivo)
                            @Html.TextBox("ArquivoDescricaoMotivoAvalista", null, new { @class = "form-control", @maxlength = "255" })
                        </div>
                        <div class="col-md-24">
                            @Html.Label(GlobalMessages.EnvioDeArquivo + " *", new { @class = "control-label", style = "overflow: hidden;" })
                            <input name="arquivoAvalista" id="arquivoAvalista" type="file" class="control-label" style="width: 100%;" accept="application/pdf">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" title="@GlobalMessages.Enviar" onclick="Europa.Controllers.PreProposta.ModalAvalista.Upload()">
                        <i class="fa fa-upload" aria-hidden="true"></i> @GlobalMessages.Enviar
                    </button>
                    <button type="button" class="btn" title="@GlobalMessages.Fechar" onclick="Europa.Controllers.PreProposta.ModalAvalista.Modal.Hide()">
                        <i class="fa fa-close"></i> @GlobalMessages.Fechar
                    </button>
                </div>

            </div>
        </div>
    </div>
</div>
